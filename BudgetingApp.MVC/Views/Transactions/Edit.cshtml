@model BudgetingApp.BLL.DTOs.TransactionDTO

@{
	ViewData["Title"] = "Edit";
}

<div class="row">
	<div class="d-sm-flex align-items-center justify-content-between mb-4">
		<h1 class="mt-4 mb-4"></h1>
	</div>
	<div class="col-lg-12">
		<!-- Basic Card Example -->
		<div class="card shadow mb-4">
			<div class="card-header py-3">
				<h6 class="m-0 font-weight-bold text-primary">Create Transactions</h6>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-4">
						<form method="post" asp-action="Edit" asp-route-id="@Model.TransactionID">


							<div asp-validation-summary="ModelOnly" class="text-danger"></div>
							<div class="form-group">
								<label asp-for="WalletID" class="control-label"></label>
								<select asp-for="WalletID" class="form-control" asp-items="@(new SelectList(ViewBag.Wallets, "Value", "Text"))" name="WalletID"></select>
								<span asp-validation-for="WalletID" class="text-danger"></span>
							</div>

							<div class="form-group">
								<label asp-for="TransactionType" class="control-label">Transaction Type</label>
								<select asp-for="TransactionType" class="form-control" id="TransactionType">
									<option value="">Select Transaction Type</option>
									<option value="1">Pengeluaran</option>
									<option value="2">Pemasukan</option>
								</select>
								<span asp-validation-for="TransactionType" class="text-danger"></span>
							</div>

							<div class="form-group">
								<label asp-for="TransactionCategoryID" class="control-label">Transaction Category</label>
								<select asp-for="TransactionCategoryID" class="form-control" id="TransactionCategoryID" name="TransactionCategoryID">
									<option value="">Select Transaction Category</option>
								</select>
								<span asp-validation-for="TransactionCategoryID" class="text-danger"></span>
							</div>

							<div class="form-group">
								<label asp-for="Amount" class="control-label">Amount</label>
								<input asp-for="Amount" class="form-control" name="Amount" />
								<span asp-validation-for="Amount" class="text-danger"></span>
							</div>

							<div class="form-group">
								<label asp-for="Date" class="control-label">Date</label>
								<input asp-for="Date" class="form-control" type="date" name="Date" />
								<span asp-validation-for="Date" class="text-danger"></span>
							</div>


							<div class="form-group">
								<label asp-for="Description" class="control-label">Description</label>
								<input asp-for="Description" class="form-control" name="Description" />
								<span asp-validation-for="Description" class="text-danger"></span>
							</div>

							<div class="form-group">
								<label asp-for="UserID" class="control-label">UserID</label>
								<input asp-for="UserID" class="form-control" name="UserID" readonly />
								<span asp-validation-for="UserID" class="text-danger"></span>
							</div>

							<input type="hidden" asp-for="TransactionID" name="TransactionID" />
							<input type="submit" value="Edit" class="btn btn-primary" />

						</form>
					</div>
				</div>

				<div>
					<a asp-action="Index">Back to List</a>
				</div>
			</div>
		</div>
	</div>
</div>


@section Scripts {
	<script>
		$(document).ready(function () {
			var selectedTransactionType = '@(ViewBag.TransactionType)';
			var selectedTransactionCategory = '@(ViewBag.TransactionCategoryID)';

			if (selectedTransactionType !== '') {
				$('#TransactionType').val(selectedTransactionType);
			}

			if (selectedTransactionCategory !== '') {
				$('#TransactionCategoryID').val(selectedTransactionCategory);
			}
			function getCategories(select) {
				var transactionType = select.value;
				var url = '@Url.Action("GetCategoryByType", "Transactions")';

				$.getJSON(url, { transactionTypeId: transactionType }, function (data) {
					var options = '<option value="">Select Transaction Category</option>';
					$.each(data, function (i, category) {
						options += '<option value="' + category.value + '">' + category.text + '</option>';
					});
					$('#TransactionCategoryID').html(options);


					if ('@ViewBag.TransactionCategoryID' !== '') {
						$('#TransactionCategoryID').val('@ViewBag.TransactionCategoryID');
					}
				});
			}

		
			getCategories($('#TransactionType')[0]);

			
			$('#TransactionType').change(function () {
				getCategories(this);
			});
		});
	</script>
}
