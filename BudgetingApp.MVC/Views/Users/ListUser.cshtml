@using BudgetingApp.BLL.DTOs
@using Newtonsoft.Json
@model IEnumerable<BudgetingApp.BLL.DTOs.UserDTO>

@{
	ViewData["Title"] = "ListUser";
}

@if (Context.Session.GetString("user") != null)
{
	var userLogin = JsonConvert.DeserializeObject<UserDTO>(Context.Session.GetString("user"));
	var userRole = userLogin.Role;
	@if (userRole != "admin")
	{
		<script>
			window.location.href = '/Home/';
		</script>
	}
}

<div class="row">
	<div class="d-sm-flex align-items-center justify-content-between mb-4">
		<h1 class="mt-4 mb-4"></h1>
	</div>
	<div class="col-lg-12">
		<!-- Basic Card Example -->
		<div class="card shadow mb-4">
			<div class="card-header py-3">
				<h6 class="m-0 font-weight-bold text-primary">List User Page</h6>
			</div>
			<div class="card-body">
				
				<div class="row">
					<div class="col">
						<h5>Change User Role</h5>

						<form class="form-inline mb-3" method="post" asp-action="UpdateRole">
							<label for="Username" class="mr-1">Username</label>
							<select name="userId" class="form-control mr-3" asp-items="@ViewBag.Users">
								<option value="0">--Select User--</option>
							</select>

							<label for="Roles" class="mr-1">Roles</label>
							<select name="role" class="form-control mr-3" asp-items="@ViewBag.Roles">
								<option value="0">--Select Roles--</option>
							</select>

							<button type="Submit" class="btn btn-primary mb-2">Save</button>
						</form>

					</div>
				<table class="table">
					<thead>
						<tr>
							<th>
								@Html.DisplayNameFor(model => model.UserID)
							</th>
							<th>
								@Html.DisplayNameFor(model => model.Email)
							</th>
							<th>
								@Html.DisplayNameFor(model => model.Username)
							</th>
							<th>
								@Html.DisplayNameFor(model => model.FullName)
							</th>
							<th>
								@Html.DisplayNameFor(model => model.Role)
							</th>
							
						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model)
						{
							<tr>
								<td>
									@Html.DisplayFor(modelItem => item.UserID)
								</td>
								<td>
									@Html.DisplayFor(modelItem => item.Email)
								</td>
								<td>
									@Html.DisplayFor(modelItem => item.Username)
								</td>
								<td>
									@Html.DisplayFor(modelItem => item.FullName)
								</td>
								<td>
									@Html.DisplayFor(modelItem => item.Role)
								</td>
								
							</tr>
						}
					</tbody>
				</table>

			</div>
		</div>
	</div>
</div>

